<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>G.N.R - NA Block Professional Report</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root {
            --bg-grey: #1c1c1e;
            --card-grey: #2c2c2e;
            --text-white: #ffffff;
            --accent-blue: #00d2ff;
            --green: #2ecc71;
            --red: #ff4d4d;
            --border: #3a3a3c;
        }

        body {
            font-family: 'Segoe UI', sans-serif;
            background-color: var(--bg-grey);
            color: var(--text-white);
            margin: 0;
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        #reportCapture {
            background-color: var(--card-grey);
            width: 100%;
            max-width: 800px;
            padding: 30px;
            border-radius: 15px;
            border: 1px solid var(--border);
            position: relative;
        }

        .brand-tag {
            position: absolute;
            top: 15px;
            right: 20px;
            font-size: 0.7rem;
            font-weight: bold;
            color: #888;
            letter-spacing: 1px;
        }

        .header-section { text-align: center; margin-bottom: 30px; }
        .header-title { text-transform: uppercase; letter-spacing: 2px; font-size: 1.5rem; margin: 0; font-weight: 800; color: white; }

        .view-selector-container { margin-bottom: 20px; width: 100%; max-width: 800px; }
        .selector {
            width: 100%; padding: 12px; background: #000; color: var(--accent-blue);
            border: 2px solid var(--accent-blue); border-radius: 8px; font-weight: bold;
        }

        table { width: 100%; border-collapse: separate; border-spacing: 0 15px; }
        th { color: #8e8e93; font-size: 0.75rem; text-transform: uppercase; padding: 10px; }
        td { background: #1c1c1e; padding: 18px 10px; text-align: center; border-top: 1px solid var(--border); border-bottom: 1px solid var(--border); }
        
        td:first-child { border-left: 1px solid var(--border); border-radius: 10px 0 0 10px; color: var(--accent-blue); font-weight: bold; }
        td:last-child { border-right: 1px solid var(--border); border-radius: 0 10px 10px 0; color: #d1d1d6; font-size: 0.8rem; }

        .abs-input {
            width: 55px; background: #000; border: 1px solid #444; color: var(--red);
            padding: 8px; text-align: center; border-radius: 5px; font-weight: bold; outline: none;
        }
        input::-webkit-outer-spin-button, input::-webkit-inner-spin-button { -webkit-appearance: none; margin: 0; }

        .clap-icon { margin-left: 8px; font-size: 1.2rem; }

        #appreciationArea {
            margin: 20px 0; padding: 15px; background: rgba(46, 204, 113, 0.1);
            border: 1px dashed var(--green); border-radius: 10px; text-align: center; display: none;
        }

        .chart-container { width: 100%; height: 350px; margin: 30px auto; }
        
        .official-note {
            text-align: center; color: #ff9f0a; font-weight: bold; text-transform: uppercase;
            font-size: 0.8rem; margin-top: 20px; border-top: 1px solid var(--border); padding-top: 20px;
        }

        .controls-area { width: 100%; max-width: 800px; margin-top: 20px; }
        .btn-save {
            width: 100%; padding: 15px; border-radius: 10px; border: none;
            font-weight: bold; cursor: pointer; background: white; color: black;
        }
        .hidden { display: none; }

        .pcr-btn { padding: 8px 15px; border-radius: 6px; border: none; font-weight: bold; cursor: pointer; font-size: 0.75rem; }
    </style>
</head>
<body>

    <div class="view-selector-container">
        <select class="selector" id="mode" onchange="switchView()">
            <option value="attendance">üìã ATTENDANCE REPORT VIEW</option>
            <option value="pcr">üìë PCR STATUS VIEW</option>
        </select>
    </div>

    <div id="reportCapture">
        <div class="brand-tag">DESIGNED BY GNR</div>
        <div class="header-section">
            <h1 class="header-title" id="mainTitle">Na Block 1st Year Attendance Report</h1>
        </div>

        <div id="attendanceView">
            <table>
                <thead>
                    <tr>
                        <th>Section</th>
                        <th>Total</th>
                        <th>Absent</th>
                        <th>%</th>
                        <th>Mentor Name</th>
                    </tr>
                </thead>
                <tbody id="attBody"></tbody>
            </table>
        </div>

        <div id="pcrView" class="hidden">
            <table>
                <thead>
                    <tr>
                        <th>Section</th>
                        <th>Mentor Name</th>
                        <th>PCR Status</th>
                    </tr>
                </thead>
                <tbody id="pcrBody"></tbody>
            </table>
        </div>

        <div id="appreciationArea">
            <p style="color: var(--green); font-weight: bold; margin: 0;" id="appText"></p>
        </div>

        <div class="chart-container">
            <canvas id="sectionsBarChart"></canvas>
        </div>

        <div class="official-note">
            ‚ö†Ô∏è Update PCR data for your respective sections immediately!
        </div>
    </div>

    <div class="controls-area">
        <button class="btn-save" onclick="downloadReport()">üì• Download Final Report</button>
    </div>

    <script>
        const sections = [
            { n: "CSE-C", s: 60, m: "Mr.Yogesh/Ms.Anusuya" },
            { n: "CSE-D", s: 62, m: "Dr.Adrish/Mr.Govind rao" },
            { n: "CSE-E", s: 58, m: "Ms.Sukanya/Mr.Pradeep" },
            { n: "CSM-A", s: 63, m: "Ms.Shivani/Ms.K.Shivani" },
            { n: "IT-A", s: 49, m: "Ms.Alpana Singh/Mr.Sujith" },
            { n: "ECE-A", s: 69, m: "Ms.Sumayyah/Mr.Sainath" },
            { n: "ECE-B", s: 69, m: "Mr.Muzammil/Ms.Anusha" },
            { n: "DS", s: 62, m: "Dr.Subhasish/Ms.Jayanthi" }
        ];

        let barChart;

        function init() {
            const ab = document.getElementById('attBody');
            const pb = document.getElementById('pcrBody');

            sections.forEach((c, i) => {
                ab.innerHTML += `
                    <tr>
                        <td id="name-${i}">${c.n}</td>
                        <td>${c.s}</td>
                        <td><input type="number" class="abs-input" id="abs-${i}" placeholder="" oninput="calculate()"></td>
                        <td id="p-${i}" style="font-weight:bold; color:var(--green);">100%</td>
                        <td>${c.m}</td>
                    </tr>
                `;
                pb.innerHTML += `
                    <tr>
                        <td>${c.n}</td>
                        <td>${c.m}</td>
                        <td><button class="pcr-btn" style="background:var(--red); color:white;" onclick="togglePCR(this)">NOT SUBMITTED</button></td>
                    </tr>
                `;
            });
            setupChart();
            calculate();
        }

        function calculate() {
            let combinedData = [];
            let totalS = 0, totalA = 0;

            sections.forEach((c, i) => {
                let a = parseInt(document.getElementById(`abs-${i}`).value) || 0;
                let perc = ((c.s - a) / c.s) * 100;
                
                document.getElementById(`p-${i}`).innerText = perc.toFixed(1) + "%";
                document.getElementById(`p-${i}`).style.color = perc >= 90 ? "var(--green)" : (perc >= 75 ? "#ff9f0a" : "var(--red)");
                
                // Reset Clap for Attendance View
                document.getElementById(`name-${i}`).innerHTML = c.n;

                combinedData.push({ label: c.n, value: perc });
                totalS += c.s; totalA += a;
            });

            // Sort Descending
            combinedData.sort((a, b) => b.value - a.value);

            // Add Clap to highest in Attendance View
            const topLabel = combinedData[0].label;
            sections.forEach((c, i) => {
                if(c.n === topLabel) {
                    document.getElementById(`name-${i}`).innerHTML = c.n + '<span class="clap-icon">üëè</span>';
                }
            });

            // Update Chart
            barChart.data.labels = combinedData.map(d => d.label);
            barChart.data.datasets[0].data = combinedData.map(d => d.value);
            barChart.update();

            const overall = ((totalS - totalA) / totalS) * 100;
            const appArea = document.getElementById('appreciationArea');
            if (overall >= 92) {
                appArea.style.display = 'block';
                document.getElementById('appText').innerText = `Block Excellence: ${overall.toFixed(1)}% Attendance üèÜ`;
            } else { appArea.style.display = 'none'; }
        }

        function setupChart() {
            const ctx = document.getElementById('sectionsBarChart').getContext('2d');
            barChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: [],
                    datasets: [{
                        label: 'Attendance %',
                        data: [],
                        backgroundColor: '#00d2ff',
                        borderRadius: 5,
                        barThickness: 20
                    }]
                },
                options: {
                    indexAxis: 'y',
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        x: { min: 0, max: 100, ticks: { color: '#888' }, grid: { color: '#333' } },
                        y: { ticks: { color: 'white', font: { weight: 'bold' } }, grid: { display: false } }
                    },
                    plugins: { 
                        legend: { display: false },
                        title: { display: true, text: 'SECTION ATTENDANCE RANKING (DESCENDING)', color: 'white' }
                    }
                }
            });
        }

        function togglePCR(btn) {
            const isSub = btn.innerText === "SUBMITTED";
            btn.innerText = isSub ? "NOT SUBMITTED" : "SUBMITTED";
            btn.style.background = isSub ? "var(--red)" : "var(--green)";
            btn.style.color = isSub ? "white" : "black";
        }

        function switchView() {
            const isAtt = document.getElementById('mode').value === 'attendance';
            document.getElementById('attendanceView').classList.toggle('hidden', !isAtt);
            document.getElementById('pcrView').classList.toggle('hidden', isAtt);
            document.getElementById('mainTitle').innerText = isAtt ? "Na Block 1st Year Attendance Report" : "Na Block 1st Year PCR Status Report";
        }

        function downloadReport() {
            html2canvas(document.getElementById('reportCapture'), { backgroundColor: '#1c1c1e', scale: 2 }).then(canvas => {
                const link = document.createElement('a');
                link.download = `NA_Block_Professional_Report.png`;
                link.href = canvas.toDataURL();
                link.click();
            });
        }

        init();
    </script>
</body>
</html>
